name: Visual Regression Tests

on: 
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    visual-tests:
        runs-on: ubuntu-latest
        steps: 
        - name: Checkout code
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
        
        - name: Setup Node.js
          uses: actions/setup-node@v4
          with: 
            node-version: 20
            cache: "npm"
        
        - name: Install Dependencies
          run: npm ci

        - name: Install Playwright browsers
          run: npx playwright install --with-deps

        - name: Run visual regression tests
          run: npm run test:visual
        
        - name: Upload failed screenshots (optional step)
          if: failure()
          uses: actions/upload-artifact@v4
          with:
            name: failed-snapshots
            path: | 
                **/__diff_output__/**